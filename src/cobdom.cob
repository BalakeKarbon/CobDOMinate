000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. COBDOM.
000300 ENVIRONMENT DIVISION.
000400 CONFIGURATION SECTION.
000500 SOURCE-COMPUTER. UNIX-LINUX.
000600 OBJECT-COMPUTER. WASM.
000700 INPUT-OUTPUT SECTION.
000800 FILE-CONTROL.
000900 DATA DIVISION.
001000 FILE SECTION.
001100 WORKING-STORAGE SECTION.
001200 COPY './data/js.cpy'.
001300 LINKAGE SECTION.
001400 01 LS-VERSION PIC 99V99.
001500 01 LS-ELEMENT-VARIABLE PIC X(128).
001600 01 LS-ELEMENT-TYPE PIC X(128).
001700 01 LS-PARENT PIC X(128).
001800 01 LS-RETURN PIC S9.
001900 01 LS-HTML PIC X(256).
002000 01 LS-FUNCTION PIC X(64).
002100 PROCEDURE DIVISION.
002200 COBDOM-INIT SECTION.
002300*ENTRY 'COBDOM-INIT' USING LS-RETURN.
002400*  CALL 'emscripten_run_script_int' USING BY REFERENCE 
002500*  WS-COB-INIT RETURNING LS-RETURN.
002600 COBDOM-VERSION SECTION.
002700 ENTRY 'COBDOM-VERSION' USING BY REFERENCE LS-VERSION.
002800*I think by reference is redundant here.
002900   MOVE .01 TO LS-VERSION.
003000*  CALL 'emscripten_run_script_int' USING BY CONTENT WS-JS-TEST.
003100*  MOVE FUNCTION TRIM('div', TRAILING) TO WS-ELEMENT-TYPE.
003200*  DISPLAY WS-ELEMENT-TYPE '.'.
003300   GOBACK.
003400 COBDOM-CREATE-ELEMENT SECTION.
003500 ENTRY 'COBDOM-CREATE-ELEMENT' USING BY 
003600   REFERENCE LS-RETURN, LS-ELEMENT-VARIABLE,
003700   LS-ELEMENT-TYPE.
003800   STRING 
003900     PART-A OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
004000     LS-ELEMENT-VARIABLE
004100     PART-A OF CREATE-ELEMENT OF WS-JS-COMMANDS
004200     LS-ELEMENT-TYPE
004300     PART-B OF CREATE-ELEMENT OF WS-JS-COMMANDS DELIMITED BY SPACE
004400     PART-B OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
004500     WS-NULL-BYTE DELIMITED BY SIZE
004600*The null byte is needed because were passing C strings to
004700*emscripten's API.
004800   INTO WS-JS-COMMAND END-STRING.
004900   CALL 'emscripten_run_script_int' USING BY REFERENCE
005000     WS-JS-COMMAND RETURNING LS-RETURN.
005100   GOBACK.
005200 COBDOM-APPEND-CHILD SECTION.
005300 ENTRY 'COBDOM-APPEND-CHILD' USING BY REFERENCE
005400   LS-RETURN, LS-ELEMENT-VARIABLE, LS-PARENT.
005500   STRING
005600     PART-A OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
005700     LS-PARENT
005800     PART-A OF APPEND-CHILD OF WS-JS-COMMANDS
005900     LS-ELEMENT-VARIABLE DELIMITED BY SPACE
006000     WS-END-PARENTHESIS DELIMITED BY SIZE
006100     PART-B OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
006200     WS-NULL-BYTE DELIMITED BY SIZE
006300   INTO WS-JS-COMMAND END-STRING.
006400   CALL 'emscripten_run_script_int' USING BY REFERENCE
006500     WS-JS-COMMAND RETURNING LS-RETURN.
006600   GOBACK.
006700 COBDOM-REMOVE-CHILD SECTION.
006800 ENTRY 'COBDOM-REMOVE-CHILD' USING BY REFERENCE
006900   LS-ELEMENT-VARIABLE, LS-RETURN, LS-PARENT.
007000   STRING
007100     PART-A OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
007200     LS-PARENT
007300     PART-A OF REMOVE-CHILD OF WS-JS-COMMANDS
007400     LS-ELEMENT-VARIABLE DELIMITED BY SPACE
007500     WS-END-PARENTHESIS DELIMITED BY SIZE
007600     PART-B OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
007700     WS-NULL-BYTE DELIMITED BY SIZE
007800   INTO WS-JS-COMMAND END-STRING.
007900   CALL 'emscripten_run_script_int' USING BY REFERENCE 
008000     WS-JS-COMMAND RETURNING LS-RETURN.
008100   GOBACK.
008200*Correct all of the above function delimiters.
008300 COBDOM-INNER-HTML SECTION.
008400 ENTRY 'COBDOM-INNER-HTML' USING BY REFERENCE
008500   LS-RETURN, LS-ELEMENT-VARIABLE, LS-HTML.
008600   STRING
008700     PART-A OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
008800     LS-ELEMENT-VARIABLE DELIMITED BY SPACE
008900     PART-A OF INNER-HTML OF WS-JS-COMMANDS DELIMITED BY SIZE
009000     LS-HTML DELIMITED BY WS-NULL-BYTE
009100     WS-END-DOUBLE-QUOTE DELIMITED BY SIZE
009200     PART-B OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
009300     WS-NULL-BYTE DELIMITED BY SIZE
009400   INTO WS-JS-COMMAND END-STRING.
009500   CALL 'emscripten_run_script_int' USING BY REFERENCE 
009600     WS-JS-COMMAND RETURNING LS-RETURN.
009700   GOBACK.
009800 COBDOM-ADD-EVENT-LISTENER SECTION.
009900 ENTRY 'COBDOM-ADD-EVENT-LISTENER' USING BY REFERENCE
010000   LS-RETURN, LS-ELEMENT-VARIABLE, LS-ELEMENT-TYPE, 
010100   LS-FUNCTION.
010200*  DISPLAY LS-FUNCTION.
010300   STRING
010400     PART-A OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
010500     LS-ELEMENT-VARIABLE DELIMITED BY SPACE
010600     PART-A OF ADD-EVENT-LISTENER OF WS-JS-COMMANDS 
010700     DELIMITED BY SIZE
010800     LS-ELEMENT-TYPE DELIMITED BY SPACE
010900     PART-B OF ADD-EVENT-LISTENER OF WS-JS-COMMANDS 
011000     DELIMITED BY SIZE
011100     LS-FUNCTION DELIMITED BY WS-NULL-BYTE
011200*     WS-END-PARENTHESIS DELIMITED BY SIZE
011300     PART-B OF STATUS-WRAPPER OF WS-JS-COMMANDS DELIMITED BY SIZE
011400     WS-NULL-BYTE DELIMITED BY SIZE
011500   INTO WS-JS-COMMAND END-STRING.
011600*  DISPLAY WS-JS-COMMAND.
011700   CALL 'emscripten_run_script_int' USING BY REFERENCE 
011800     WS-JS-COMMAND RETURNING LS-RETURN.
011900   GOBACK.
012000*TO-DO put returns in these functions to verify success! This
012100*This will have to be done by wrapping scripts into a function
012200*with a try catch statement or something of the sort.
012300*COBDOM-INNER-HTML SECTION.
012400*ENTRY 'COBDOM-INNER-HTML' USING
012500*So here this gets crazy, since we are using eval, we can return
012600*the variable name, or we could store the objects in a structure
012700*and return its key/index, or we could create and add it relying
012800*only on the id.
